<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Dashboard</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f4f7fa;
      margin: 0;
      padding: 40px;
    }

    .container {
      max-width: 1200px;
      margin: auto;
      background: #ffffff;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    }

    /* Navigation */
    .nav {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 30px;
    }

    .nav button {
      padding: 15px 20px;
      border: none;
      border-radius: 8px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 14px;
    }

    .nav button:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
    }

    .nav button.active {
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    }

    /* Sections */
    .section {
      display: none;
      animation: fadeIn 0.5s ease;
    }

    .section.active {
      display: block;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* Quick Stats */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .stat-card {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 25px;
      border-radius: 12px;
      text-align: center;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
    }

    .stat-number {
      font-size: 2.5rem;
      font-weight: bold;
      margin-bottom: 5px;
    }

    .stat-label {
      font-size: 0.9rem;
      opacity: 0.9;
    }

    /* Forms */
    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
    }

    .form-section {
      background: #f8f9fa;
      padding: 25px;
      border-radius: 10px;
      border: 1px solid #e9ecef;
    }

    .form-section h3 {
      color: #495057;
      margin-bottom: 20px;
      font-size: 1.2rem;
    }

    input, select, textarea, button {
      width: 100%;
      padding: 12px 15px;
      margin-bottom: 15px;
      border: 1px solid #ced4da;
      border-radius: 6px;
      font-size: 14px;
      transition: border-color 0.3s ease;
      box-sizing: border-box;
    }

    input:focus, select:focus, textarea:focus {
      border-color: #667eea;
      outline: none;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    button {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    button:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
    }

    .btn-danger {
      background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
    }

    .btn-success {
      background: linear-gradient(135deg, #51cf66 0%, #40c057 100%);
    }

    /* Employee Cards */
    .employees-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }

    .employee-card {
      background: white;
      border: 1px solid #e9ecef;
      border-radius: 10px;
      padding: 20px;
      text-align: center;
      transition: all 0.3s ease;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
    }

    .employee-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
    }

    .employee-photo {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      object-fit: cover;
      margin-bottom: 15px;
      border: 3px solid #e9ecef;
    }

    .employee-default-photo {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 28px;
      font-weight: bold;
      margin: 0 auto 15px;
    }

    .employee-name {
      font-size: 1.1rem;
      font-weight: 600;
      color: #495057;
      margin-bottom: 10px;
    }

    .employee-stats {
      font-size: 0.9rem;
      color: #6c757d;
      margin-bottom: 15px;
    }

    /* Photo Upload Section */
    .photo-upload {
      border: 2px dashed #ced4da;
      border-radius: 6px;
      padding: 20px;
      text-align: center;
      margin-bottom: 15px;
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .photo-upload:hover {
      border-color: #667eea;
      background-color: #f8f9fa;
    }

    .photo-upload input {
      display: none;
    }

    .photo-preview {
      max-width: 120px;
      max-height: 120px;
      border-radius: 8px;
      margin-top: 10px;
      border: 2px solid #e9ecef;
    }

    .upload-text {
      color: #6c757d;
      font-size: 14px;
      margin-bottom: 10px;
    }

    /* Form Validation */
    .error-message {
      color: #dc3545;
      font-size: 12px;
      margin-top: -10px;
      margin-bottom: 10px;
      display: none;
    }

    .input-error {
      border-color: #dc3545 !important;
    }

    .form-feedback {
      margin-top: 15px;
      padding: 10px 15px;
      border-radius: 6px;
      display: none;
    }

    .form-feedback.success {
      background: #d4edda;
      border: 1px solid #c3e6cb;
      color: #155724;
    }

    .form-feedback.error {
      background: #f8d7da;
      border: 1px solid #f5c6cb;
      color: #721c24;
    }

    /* Loading States */
    .btn-loading {
      position: relative;
      color: transparent !important;
    }

    .btn-loading::after {
      content: "";
      position: absolute;
      width: 16px;
      height: 16px;
      top: 50%;
      left: 50%;
      margin-left: -8px;
      margin-top: -8px;
      border: 2px solid #ffffff;
      border-radius: 50%;
      border-top-color: transparent;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    /* Groups */
    .group-card {
      background: white;
      border: 1px solid #e9ecef;
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 15px;
      transition: all 0.3s ease;
    }

    .group-card:hover {
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    }

    .group-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }

    .group-name {
      font-size: 1.2rem;
      font-weight: 600;
      color: #495057;
    }

    .member-list {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }

    .member-tag {
      background: #e9ecef;
      padding: 5px 12px;
      border-radius: 15px;
      font-size: 0.8rem;
      color: #495057;
    }

    /* Employee Selector */
    .employee-selector {
      max-height: 200px;
      overflow-y: auto;
      border: 1px solid #ced4da;
      border-radius: 6px;
      padding: 10px;
      margin-bottom: 15px;
    }

    .employee-option {
      display: flex;
      align-items: center;
      padding: 8px;
      margin-bottom: 5px;
      border-radius: 4px;
      transition: background-color 0.2s ease;
    }

    .employee-option:hover {
      background: #f8f9fa;
    }

    .employee-option input[type="checkbox"] {
      width: auto;
      margin-right: 10px;
      margin-bottom: 0;
    }

    /* Modal */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      animation: fadeIn 0.3s ease;
    }

    .modal-content {
      background-color: white;
      margin: 5% auto;
      padding: 30px;
      border-radius: 10px;
      width: 90%;
      max-width: 600px;
      max-height: 80vh;
      overflow-y: auto;
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .close {
      color: #aaa;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
    }

    .close:hover {
      color: black;
    }

    /* Task Images */
    .task-photo {
      max-width: 150px;
      max-height: 120px;
      border-radius: 6px;
      margin: 5px;
      cursor: pointer;
      border: 2px solid #e9ecef;
      transition: all 0.3s ease;
    }

    .task-photo:hover {
      transform: scale(1.05);
      border-color: #667eea;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .container {
        padding: 20px;
      }
      
      .nav {
        grid-template-columns: 1fr;
      }
      
      .form-grid {
        grid-template-columns: 1fr;
      }
      
      .employees-grid {
        grid-template-columns: 1fr;
      }
    }

    /* Logout Button */
    .logout-btn {
      position: fixed;
      top: 20px;
      right: 20px;
      background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      z-index: 100;
    }

    .logout-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 15px rgba(255, 107, 107, 0.4);
    }

    .loading {
      text-align: center;
      color: #6c757d;
      font-style: italic;
      padding: 40px;
    }

    .error {
      color: #dc3545;
      background: #f8d7da;
      border: 1px solid #f5c6cb;
      padding: 10px 15px;
      border-radius: 6px;
      margin: 10px 0;
    }

    .success {
      color: #155724;
      background: #d4edda;
      border: 1px solid #c3e6cb;
      padding: 10px 15px;
      border-radius: 6px;
      margin: 10px 0;
    }
  </style>
</head>
<body>
  <button class="logout-btn" onclick="logout()">Logout</button>
  
  <div class="container">
    <h1>Admin Dashboard</h1>
    
    <!-- Navigation -->
    <div class="nav">
      <button onclick="showSection('stats')" class="active">📊 Dashboard</button>
      <button onclick="showSection('add-employee')">👤➕ Add Employee</button>
      <button onclick="showSection('assign-tasks')">📋➕ Assign Tasks</button>
      <button onclick="showSection('manage-groups')">👥 Manage Groups</button>
      <button onclick="showSection('reports')">📊 View Reports</button>
      <button onclick="goToChat()">💬 Chat</button>
    </div>

    <!-- Quick Stats Section -->
    <div id="stats" class="section active">
      <h2>📈 Quick Statistics</h2>
      <div class="stats-grid" id="statsGrid">
        <div class="loading">Loading statistics...</div>
      </div>
    </div>

    <!-- ✅ ENHANCED ADD EMPLOYEE SECTION -->
    <div id="add-employee" class="section">
      <h2>👤➕ Add New Employee</h2>
      <div class="form-section">
        <h3>Employee Registration Form</h3>
        <form id="addEmployeeForm" enctype="multipart/form-data">
          <!-- Personal Information -->
          <div style="margin-bottom: 20px;">
            <h4 style="color: #495057; margin-bottom: 15px;">📋 Personal Information</h4>
            
            <input type="text" name="name" id="empName" placeholder="Full Name *" required>
            <div class="error-message" id="nameError">Please enter a valid name</div>
            
            <input type="email" name="email" id="empEmail" placeholder="Email Address *" required>
            <div class="error-message" id="emailError">Please enter a valid email address</div>
            
            <input type="tel" name="phone" id="empPhone" placeholder="Phone Number (10 digits) *" 
                   pattern="[6-9][0-9]{9}" maxlength="10" required>
            <div class="error-message" id="phoneError">Please enter a valid 10-digit phone number starting with 6-9</div>
            
            <input type="text" name="aadharNo" id="empAadhar" placeholder="Aadhar Number (12 digits) *" 
                   pattern="[0-9]{12}" maxlength="12" required>
            <div class="error-message" id="aadharError">Please enter a valid 12-digit Aadhar number</div>
          </div>

          <!-- Account Information -->
          <div style="margin-bottom: 20px;">
            <h4 style="color: #495057; margin-bottom: 15px;">🔐 Account Information</h4>
            
            <input type="text" name="username" id="empUsername" placeholder="Username *" required minlength="3">
            <div class="error-message" id="usernameError">Username must be at least 3 characters long</div>
            
            <input type="password" name="password" id="empPassword" placeholder="Password *" required minlength="6">
            <div class="error-message" id="passwordError">Password must be at least 6 characters long</div>
            
            <select name="role" id="empRole" required>
              <option value="employee">👤 Employee</option>
            </select>
            <div class="error-message" id="roleError">Please select a role</div>
          </div>

          <!-- Photo Upload -->
          <div style="margin-bottom: 20px;">
            <h4 style="color: #495057; margin-bottom: 15px;">📷 Profile Photo</h4>
            <div class="photo-upload" onclick="document.getElementById('empPhoto').click()">
              <input type="file" name="photo" id="empPhoto" accept="image/*">
              <div class="upload-text">📷 Click to upload profile photo (Optional)</div>
              <div>Supported formats: JPG, PNG, GIF (Max: 5MB)</div>
              <img id="photoPreview" class="photo-preview" style="display: none;">
            </div>
          </div>

          <button type="submit" id="submitBtn">➕ Add Employee</button>
        </form>
        
        <!-- Feedback Message -->
        <div class="form-feedback" id="formFeedback"></div>
      </div>
    </div>

    <!-- Task Assignment Section -->
    <div id="assign-tasks" class="section">
      <h2>📋➕ Assign Tasks</h2>
      <div class="form-grid">
        <!-- Individual Task Assignment -->
        <div class="form-section">
          <h3>Individual Assignment</h3>
          <form id="individualTaskForm">
            <select id="employeeSelect" required>
              <option value="">Select Employee...</option>
            </select>
            <textarea name="description" placeholder="Task Description *" required></textarea>
            <button type="submit">📤 Assign to Selected Employee</button>
          </form>
        </div>

        <!-- Bulk Task Assignment -->
        <div class="form-section">
          <h3>Assign to All Employees</h3>
          <form id="bulkTaskForm">
            <textarea name="description" placeholder="Task Description *" required></textarea>
            <button type="submit">📢 Assign to All Employees</button>
          </form>
        </div>

        <!-- Group Task Assignment -->
        <div class="form-section">
          <h3>Group Assignment</h3>
          <form id="groupTaskForm">
            <select id="assignGroupSelect" required>
              <option value="">Select Created Group...</option>
            </select>
            <textarea name="description" placeholder="Task Description for Group *" required></textarea>
            <button type="submit">👥 Assign to Group</button>
          </form>
        </div>
      </div>
    </div>

    <!-- Group Management Section -->
    <div id="manage-groups" class="section">
      <h2>👥 Manage Groups</h2>
      <div class="form-grid">
        <!-- Create Group -->
        <div class="form-section">
          <h3>Create New Group</h3>
          <form id="createGroupForm">
            <input type="text" name="groupName" placeholder="Group Name *" required>
            <textarea name="description" placeholder="Group Description (optional)"></textarea>
            <div class="employee-selector" id="employeeSelector">
              <div class="loading">Loading employees...</div>
            </div>
            <button type="submit">➕ Create Group</button>
          </form>
        </div>
        
        <!-- Group List -->
        <div class="form-section">
          <h3>Existing Groups</h3>
          <div id="groupsList">
            <div class="loading">Loading groups...</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Reports Section -->
    <div id="reports" class="section">
      <h2>📊 Employee Reports</h2>
      <div id="reportContent">
        <div class="loading">Loading reports...</div>
      </div>
    </div>
  </div>

  <!-- Employee Detail Modal -->
  <div id="employeeModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Employee Details</h3>
        <span class="close" onclick="closeModal('employeeModal')">&times;</span>
      </div>
      <div id="employeeDetails"></div>
    </div>
  </div>

  <!-- Task History Modal -->
  <div id="taskModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Task History</h3>
        <span class="close" onclick="closeModal('taskModal')">&times;</span>
      </div>
      <div id="taskDetails"></div>
    </div>
  </div>

  <!-- Image Viewer Modal -->
  <div id="imageModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Task Image</h3>
        <span class="close" onclick="closeModal('imageModal')">&times;</span>
      </div>
      <img id="modalImage" style="width: 100%; height: auto; border-radius: 6px;">
    </div>
  </div>

  <script>
    // Global Variables
    const token = localStorage.getItem('token');
    let allEmployees = [];
    let allGroups = [];

    // Check authentication
    if (!token || localStorage.getItem('role') !== 'admin') {
      window.location.href = 'index.html';
    }

    // ✅ ENHANCED FORM VALIDATION
    class FormValidator {
      static validateName(name) {
        return name.trim().length >= 2 && /^[a-zA-Z\s]+$/.test(name.trim());
      }

      static validateEmail(email) {
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        return emailRegex.test(email.trim());
      }

      static validatePhone(phone) {
        const phoneRegex = /^[6-9][0-9]{9}$/;
        return phoneRegex.test(phone.trim());
      }

      static validateAadhar(aadhar) {
        const aadharRegex = /^[0-9]{12}$/;
        return aadharRegex.test(aadhar.trim());
      }

      static validateUsername(username) {
        return username.trim().length >= 3 && /^[a-zA-Z0-9_]+$/.test(username.trim());
      }

      static validatePassword(password) {
        return password.length >= 6;
      }

      static showError(fieldId, message) {
        const field = document.getElementById(fieldId);
        const errorDiv = document.getElementById(fieldId.replace('emp', '').toLowerCase() + 'Error');
        
        field.classList.add('input-error');
        errorDiv.textContent = message;
        errorDiv.style.display = 'block';
      }

      static clearError(fieldId) {
        const field = document.getElementById(fieldId);
        const errorDiv = document.getElementById(fieldId.replace('emp', '').toLowerCase() + 'Error');
        
        field.classList.remove('input-error');
        errorDiv.style.display = 'none';
      }

      static clearAllErrors() {
        const errorDivs = document.querySelectorAll('.error-message');
        const inputFields = document.querySelectorAll('.input-error');
        
        errorDivs.forEach(div => div.style.display = 'none');
        inputFields.forEach(field => field.classList.remove('input-error'));
      }
    }

    // ✅ ENHANCED PHOTO UPLOAD
    document.getElementById('empPhoto').addEventListener('change', function(e) {
      const file = e.target.files[0];
      const preview = document.getElementById('photoPreview');
      const uploadText = document.querySelector('.upload-text');
      
      if (file) {
        // Validate file type
        if (!file.type.startsWith('image/')) {
          alert('❌ Please select a valid image file (JPG, PNG, GIF)');
          this.value = '';
          return;
        }
        
        // Validate file size (5MB)
        if (file.size > 5 * 1024 * 1024) {
          alert('❌ File size must be less than 5MB');
          this.value = '';
          return;
        }
        
        // Show preview
        const reader = new FileReader();
        reader.onload = function(e) {
          preview.src = e.target.result;
          preview.style.display = 'block';
          uploadText.textContent = '✅ Photo Selected: ' + file.name;
        };
        reader.readAsDataURL(file);
      } else {
        preview.style.display = 'none';
        uploadText.textContent = '📷 Click to upload profile photo (Optional)';
      }
    });

    // ✅ REAL-TIME VALIDATION
    document.getElementById('empName').addEventListener('blur', function() {
      const name = this.value;
      if (name && !FormValidator.validateName(name)) {
        FormValidator.showError('empName', 'Name should contain only letters and be at least 2 characters');
      } else {
        FormValidator.clearError('empName');
      }
    });

    document.getElementById('empEmail').addEventListener('blur', function() {
      const email = this.value;
      if (email && !FormValidator.validateEmail(email)) {
        FormValidator.showError('empEmail', 'Please enter a valid email address');
      } else {
        FormValidator.clearError('empEmail');
      }
    });

    document.getElementById('empPhone').addEventListener('input', function() {
      // Only allow numbers
      this.value = this.value.replace(/[^0-9]/g, '');
      
      const phone = this.value;
      if (phone && !FormValidator.validatePhone(phone)) {
        FormValidator.showError('empPhone', 'Phone number must be 10 digits starting with 6-9');
      } else {
        FormValidator.clearError('empPhone');
      }
    });

    document.getElementById('empAadhar').addEventListener('input', function() {
      // Only allow numbers
      this.value = this.value.replace(/[^0-9]/g, '');
      
      const aadhar = this.value;
      if (aadhar && !FormValidator.validateAadhar(aadhar)) {
        FormValidator.showError('empAadhar', 'Aadhar number must be exactly 12 digits');
      } else {
        FormValidator.clearError('empAadhar');
      }
    });

    document.getElementById('empUsername').addEventListener('blur', function() {
      const username = this.value;
      if (username && !FormValidator.validateUsername(username)) {
        FormValidator.showError('empUsername', 'Username must be at least 3 characters (letters, numbers, underscore only)');
      } else {
        FormValidator.clearError('empUsername');
      }
    });

    document.getElementById('empPassword').addEventListener('blur', function() {
      const password = this.value;
      if (password && !FormValidator.validatePassword(password)) {
        FormValidator.showError('empPassword', 'Password must be at least 6 characters long');
      } else {
        FormValidator.clearError('empPassword');
      }
    });

    // ✅ ENHANCED ADD EMPLOYEE FORM SUBMISSION
    document.getElementById('addEmployeeForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      // Clear previous feedback
      FormValidator.clearAllErrors();
      const feedback = document.getElementById('formFeedback');
      feedback.style.display = 'none';
      
      // Get form data
      const formData = new FormData(e.target);
      const name = formData.get('name').trim();
      const email = formData.get('email').trim();
      const phone = formData.get('phone').trim();
      const aadharNo = formData.get('aadharNo').trim();
      const username = formData.get('username').trim();
      const password = formData.get('password');
      const role = formData.get('role');
      
      let hasErrors = false;
      
      // Validate all fields
      if (!FormValidator.validateName(name)) {
        FormValidator.showError('empName', 'Please enter a valid name (letters only, min 2 chars)');
        hasErrors = true;
      }
      
      if (!FormValidator.validateEmail(email)) {
        FormValidator.showError('empEmail', 'Please enter a valid email address');
        hasErrors = true;
      }
      
      if (!FormValidator.validatePhone(phone)) {
        FormValidator.showError('empPhone', 'Please enter a valid 10-digit phone number starting with 6-9');
        hasErrors = true;
      }
      
      if (!FormValidator.validateAadhar(aadharNo)) {
        FormValidator.showError('empAadhar', 'Please enter a valid 12-digit Aadhar number');
        hasErrors = true;
      }
      
      if (!FormValidator.validateUsername(username)) {
        FormValidator.showError('empUsername', 'Username must be at least 3 characters (letters, numbers, underscore only)');
        hasErrors = true;
      }
      
      if (!FormValidator.validatePassword(password)) {
        FormValidator.showError('empPassword', 'Password must be at least 6 characters long');
        hasErrors = true;
      }
      
      if (!role) {
        FormValidator.showError('empRole', 'Please select a role');
        hasErrors = true;
      }
      
      if (hasErrors) {
        feedback.className = 'form-feedback error';
        feedback.textContent = '❌ Please fix the errors above before submitting';
        feedback.style.display = 'block';
        return;
      }
      
      // Show loading state
      const submitBtn = document.getElementById('submitBtn');
      const originalText = submitBtn.textContent;
      submitBtn.classList.add('btn-loading');
      submitBtn.disabled = true;
      
      try {
        console.log('🚀 Submitting employee form...', {
          name, email, phone, aadharNo, username, role,
          hasPhoto: !!formData.get('photo').name
        });
        
        const response = await fetch('/admin/employee', {
          method: 'POST',
          headers: { 'Authorization': 'Bearer ' + token },
          body: formData
        });
        
        const result = await response.json();
        console.log('📡 Server response:', response.status, result);
        
        if (response.ok) {
          // Success
          feedback.className = 'form-feedback success';
          feedback.textContent = '✅ Employee added successfully!';
          feedback.style.display = 'block';
          
          // Reset form
          e.target.reset();
          document.getElementById('photoPreview').style.display = 'none';
          document.querySelector('.upload-text').textContent = '📷 Click to upload profile photo (Optional)';
          
          // Reload data
          loadEmployees();
          loadEmployeesForGrouping();
          loadStats();
          
          // Hide success message after 3 seconds
          setTimeout(() => {
            feedback.style.display = 'none';
          }, 3000);
          
        } else {
          // Server error
          feedback.className = 'form-feedback error';
          feedback.textContent = `❌ Failed to add employee: ${result.message || 'Unknown error'}`;
          feedback.style.display = 'block';
          
          console.error('❌ Server error details:', result);
        }
        
      } catch (error) {
        // Network error
        console.error('🔥 Network error:', error);
        feedback.className = 'form-feedback error';
        feedback.textContent = '❌ Network error. Please check your connection and try again.';
        feedback.style.display = 'block';
        
      } finally {
        // Remove loading state
        submitBtn.classList.remove('btn-loading');
        submitBtn.disabled = false;
        submitBtn.textContent = originalText;
      }
    });

    // Navigation
    function showSection(sectionId) {
      // Hide all sections
      document.querySelectorAll('.section').forEach(section => {
        section.classList.remove('active');
      });
      
      // Remove active class from all nav buttons
      document.querySelectorAll('.nav button').forEach(btn => {
        btn.classList.remove('active');
      });
      
      // Show selected section
      document.getElementById(sectionId).classList.add('active');
      
      // Add active class to clicked button
      event.target.classList.add('active');
      
      // Load data based on section
      switch(sectionId) {
        case 'stats':
          loadStats();
          break;
        case 'assign-tasks':
          loadEmployees();
          loadGroupsForAssignment();
          break;
        case 'manage-groups':
          loadEmployeesForGrouping();
          loadGroups();
          break;
        case 'reports':
          loadReports();
          break;
      }
    }

    // Load Statistics
    async function loadStats() {
      try {
        const statsGrid = document.getElementById('statsGrid');
        statsGrid.innerHTML = '<div class="loading">Loading statistics...</div>';

        const [employeesRes, reportRes] = await Promise.all([
          fetch('/admin/employees', { headers: { 'Authorization': 'Bearer ' + token } }),
          fetch('/admin/report', { headers: { 'Authorization': 'Bearer ' + token } })
        ]);

        const employees = await employeesRes.json();
        const report = await reportRes.json();

        const totalEmployees = employees.length;
        const totalTasks = report.reduce((sum, emp) => sum + emp.total, 0);
        const completedTasks = report.reduce((sum, emp) => sum + emp.completed, 0);
        const processingTasks = report.reduce((sum, emp) => sum + emp.processing, 0);
        const pendingTasks = report.reduce((sum, emp) => sum + emp.pending, 0);
        const completionRate = totalTasks > 0 ? ((completedTasks / totalTasks) * 100).toFixed(1) : 0;

        statsGrid.innerHTML = `
          <div class="stat-card">
            <div class="stat-number">${totalEmployees}</div>
            <div class="stat-label">Total Employees</div>
          </div>
          <div class="stat-card">
            <div class="stat-number">${totalTasks}</div>
            <div class="stat-label">Total Tasks</div>
          </div>
          <div class="stat-card">
            <div class="stat-number">${completedTasks}</div>
            <div class="stat-label">Completed Tasks</div>
          </div>
          <div class="stat-card">
            <div class="stat-number">${processingTasks}</div>
            <div class="stat-label">In Progress</div>
          </div>
          <div class="stat-card">
            <div class="stat-number">${pendingTasks}</div>
            <div class="stat-label">Pending Tasks</div>
          </div>
          <div class="stat-card">
            <div class="stat-number">${completionRate}%</div>
            <div class="stat-label">Completion Rate</div>
          </div>
        `;
      } catch (error) {
        console.error('Error loading stats:', error);
        document.getElementById('statsGrid').innerHTML = '<div class="error">Failed to load statistics</div>';
      }
    }

    // Load Employees
    async function loadEmployees() {
      try {
        const response = await fetch('/admin/employees', {
          headers: { 'Authorization': 'Bearer ' + token }
        });
        allEmployees = await response.json();
        
        const employeeSelect = document.getElementById('employeeSelect');
        employeeSelect.innerHTML = '<option value="">Select Employee...</option>';
        
        allEmployees.forEach(emp => {
          const option = document.createElement('option');
          option.value = emp._id;
          option.textContent = emp.name;
          employeeSelect.appendChild(option);
        });
      } catch (error) {
        console.error('Error loading employees:', error);
      }
    }

    // Load Groups for Assignment
    async function loadGroupsForAssignment() {
      try {
        console.log('🔄 Loading groups for task assignment...');
        
        const response = await fetch('/admin/groups', {
          method: 'GET',
          headers: { 
            'Authorization': 'Bearer ' + token,
            'Content-Type': 'application/json'
          }
        });
        
        if (!response.ok) {
          throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }
        
        const data = await response.json();
        console.log('📋 Groups API response:', data);
        
        const dropdown = document.getElementById('assignGroupSelect');
        if (!dropdown) {
          console.error('❌ Dropdown element not found!');
          return;
        }
        
        dropdown.innerHTML = '<option value="">Select Created Group...</option>';
        
        if (data.success && data.groups && data.groups.length > 0) {
          data.groups.forEach(group => {
            const option = document.createElement('option');
            option.value = group.id;
            option.textContent = `${group.name} (${group.memberCount} members)`;
            dropdown.appendChild(option);
          });
          console.log('✅ Groups loaded successfully');
        } else {
          dropdown.innerHTML = '<option value="">No groups created yet</option>';
        }
        
      } catch (error) {
        console.error('🔥 Error loading groups:', error);
        const dropdown = document.getElementById('assignGroupSelect');
        if (dropdown) {
          dropdown.innerHTML = '<option value="">Error loading groups</option>';
        }
      }
    }

    // Load Employees for Grouping  
    async function loadEmployeesForGrouping() {
      try {
        const response = await fetch('/admin/employees', {
          headers: { 'Authorization': 'Bearer ' + token }
        });
        allEmployees = await response.json();
        
        const selector = document.getElementById('employeeSelector');
        selector.innerHTML = '';
        
        allEmployees.forEach(emp => {
          const div = document.createElement('div');
          div.className = 'employee-option';
          div.innerHTML = `
            <input type="checkbox" value="${emp._id}" id="emp_${emp._id}">
            <label for="emp_${emp._id}">${emp.name} (${emp.email})</label>
          `;
          selector.appendChild(div);
        });
      } catch (error) {
        console.error('Error loading employees for grouping:', error);
        document.getElementById('employeeSelector').innerHTML = '<div class="error">Failed to load employees</div>';
      }
    }

    // Load Groups
    async function loadGroups() {
      try {
        const response = await fetch('/admin/groups', {
          headers: { 'Authorization': 'Bearer ' + token }
        });
        const data = await response.json();
        allGroups = data.groups || [];
        
        const groupsList = document.getElementById('groupsList');
        
        if (allGroups.length === 0) {
          groupsList.innerHTML = '<div class="loading">No groups created yet</div>';
          return;
        }
        
        groupsList.innerHTML = '';
        allGroups.forEach(group => {
          const div = document.createElement('div');
          div.className = 'group-card';
          div.innerHTML = `
            <div class="group-header">
              <span class="group-name">${group.name}</span>
              <button class="btn-danger" onclick="deleteGroup('${group.id}')" style="width: auto; padding: 5px 10px;">🗑️ Delete</button>
            </div>
            <p><strong>Description:</strong> ${group.description || 'No description'}</p>
            <p><strong>Members (${group.memberCount}):</strong></p>
            <div class="member-list">
              ${group.members.map(member => `<span class="member-tag">${member.name}</span>`).join('')}
            </div>
          `;
          groupsList.appendChild(div);
        });
      } catch (error) {
        console.error('Error loading groups:', error);
        document.getElementById('groupsList').innerHTML = '<div class="error">Failed to load groups</div>';
      }
    }

    // Load Reports
    async function loadReports() {
      try {
        const response = await fetch('/admin/report', {
          headers: { 'Authorization': 'Bearer ' + token }
        });
        const report = await response.json();
        
        const reportContent = document.getElementById('reportContent');
        
        if (report.length === 0) {
          reportContent.innerHTML = '<div class="loading">No employees found</div>';
          return;
        }
        
        reportContent.innerHTML = `
          <div class="employees-grid">
            ${report.map(r => {
              const employeePhotoHtml = r.photoPath && r.photoPath !== 'null' ? 
                `<img src="${r.photoPath}" class="employee-photo" alt="${r.name}" />` :
                `<div class="employee-default-photo">${r.name.charAt(0).toUpperCase()}</div>`;
              
              return `
                <div class="employee-card" onclick="showEmployeeDetails('${r.employeeId}')">
                  ${employeePhotoHtml}
                  <div class="employee-name">${r.name}</div>
                  <div class="employee-stats">
                    📧 ${r.email}<br>
                    📱 ${r.phone}<br>
                    📊 Total: ${r.total} | ✅ ${r.completed} | 🔄 ${r.processing} | ⏳ ${r.pending}
                  </div>
                  <button onclick="event.stopPropagation(); showEmployeeDetails('${r.employeeId}')" style="width: auto; padding: 8px 15px;">View Details</button>
                </div>
              `;
            }).join('')}
          </div>
        `;
      } catch (error) {
        console.error('Error loading reports:', error);
        document.getElementById('reportContent').innerHTML = '<div class="error">Failed to load reports</div>';
      }
    }

    // ✅ SHOW EMPLOYEE DETAILS (COMPLETE)
    async function showEmployeeDetails(employeeId) {
      try {
        const response = await fetch('/admin/report', {
          headers: { 'Authorization': 'Bearer ' + token }
        });
        const report = await response.json();
        const employee = report.find(emp => emp.employeeId === employeeId);
        
        if (!employee) {
          alert('Employee details not found');
          return;
        }
        
        const tasksHtml = employee.tasks.map(task => {
          const statusColor = {
            'Pending': '#ffc107',
            'Processing': '#17a2b8', 
            'Completed': '#28a745'
          }[task.status] || '#6c757d';
          
          const createdDateTime = new Date(task.createdAt);
          const createdDateStr = createdDateTime.toLocaleDateString('en-GB');
          const createdTimeStr = createdDateTime.toLocaleTimeString('en-GB', { 
            hour12: true, hour: '2-digit', minute: '2-digit' 
          });
          
          return `
            <div style="border: 1px solid #dee2e6; padding: 15px; margin: 10px 0; border-radius: 8px; border-left: 4px solid ${statusColor};">
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                <strong>${task.description}</strong>
                <span style="background: ${statusColor}; color: white; padding: 4px 8px; border-radius: 12px; font-size: 12px;">
                  ${task.status}
                </span>
              </div>
              <div style="font-size: 13px; color: #6c757d; margin-bottom: 8px;">
                📅 Created: ${createdDateStr} at ${createdTimeStr}
                ${task.completedAt ? ` | ✅ Completed: ${new Date(task.completedAt).toLocaleDateString('en-GB')}` : ''}
              </div>
              ${task.remark ? `<div><strong>Latest Remark:</strong> ${task.remark}</div>` : ''}
              ${task.photoPath ? `<div><strong>Photo:</strong> <img src="${task.photoPath}" class="task-photo" onclick="showImage('${task.photoPath}')" /></div>` : ''}
              ${task.status === 'Processing' ? 
                `<div style="margin-top: 10px;">
                  <button onclick="completeTask('${task._id}')" style="background: #28a745; padding: 8px 15px; font-size: 12px;">✅ Mark as Completed</button>
                  <button onclick="showTaskHistory('${task._id}')" style="background: #17a2b8; padding: 8px 15px; font-size: 12px;">📋 View History</button>
                </div>` : 
                task.status === 'Completed' ? 
                `<button onclick="showTaskHistory('${task._id}')" style="background: #17a2b8; padding: 8px 15px; font-size: 12px;">📋 View History</button>` : ''
              }
            </div>
          `;
        }).join('');
        
        document.getElementById('employeeDetails').innerHTML = `
          <div style="text-align: center; margin-bottom: 20px;">
            ${employee.photoPath && employee.photoPath !== 'null' ? 
              `<img src="${employee.photoPath}" style="width: 100px; height: 100px; border-radius: 50%; object-fit: cover;" />` :
              `<div style="width: 100px; height: 100px; border-radius: 50%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center; color: white; font-size: 32px; font-weight: bold; margin: 0 auto;">${employee.name.charAt(0).toUpperCase()}</div>`
            }
            <h3>${employee.name}</h3>
            <p>📧 ${employee.email} | 📱 ${employee.phone}</p>
          </div>
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-bottom: 20px; text-align: center;">
            <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
              <div style="font-size: 24px; font-weight: bold; color: #495057;">${employee.total}</div>
              <div style="color: #6c757d;">Total Tasks</div>
            </div>
            <div style="background: #d4edda; padding: 15px; border-radius: 8px;">
              <div style="font-size: 24px; font-weight: bold; color: #155724;">${employee.completed}</div>
              <div style="color: #155724;">Completed</div>
            </div>
            <div style="background: #cce5ff; padding: 15px; border-radius: 8px;">
              <div style="font-size: 24px; font-weight: bold; color: #004085;">${employee.processing}</div>
              <div style="color: #004085;">Processing</div>
            </div>
            <div style="background: #fff3cd; padding: 15px; border-radius: 8px;">
              <div style="font-size: 24px; font-weight: bold; color: #856404;">${employee.pending}</div>
              <div style="color: #856404;">Pending</div>
            </div>
          </div>
          <h4>📋 Task History</h4>
          <div style="max-height: 400px; overflow-y: auto;">
            ${tasksHtml || '<div style="text-align: center; padding: 20px; color: #6c757d;">No tasks assigned yet</div>'}
          </div>
        `;
        
        document.getElementById('employeeModal').style.display = 'block';
      } catch (error) {
        console.error('Error loading employee details:', error);
        alert('Failed to load employee details');
      }
    }

    // ✅ SHOW TASK HISTORY (COMPLETE)
    async function showTaskHistory(taskId) {
      try {
        const response = await fetch(`/admin/task-history/${taskId}`, {
          headers: { 'Authorization': 'Bearer ' + token }
        });
        
        if (!response.ok) {
          throw new Error('Failed to fetch task history');
        }
        
        const data = await response.json();
        
        const submissionsHtml = data.submissions.map(submission => {
          const submittedDateTime = new Date(submission.submittedAt);
          const submittedDateStr = submittedDateTime.toLocaleDateString('en-GB');
          const submittedTimeStr = submittedDateTime.toLocaleTimeString('en-GB', { 
            hour12: true, hour: '2-digit', minute: '2-digit' 
          });
          
          return `
            <div style="border: 1px solid #dee2e6; padding: 15px; margin: 10px 0; border-radius: 8px; background: #f8f9fa;">
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                <strong>📤 Submission #${submission.submissionNumber}</strong>
                <span style="font-size: 12px; color: #6c757d;">${submittedDateStr} at ${submittedTimeStr}</span>
              </div>
              <div style="margin-bottom: 10px;">
                <strong>Remark:</strong> ${submission.remark || 'No remark provided'}
              </div>
              ${submission.photoPath ? 
                `<div><strong>Photo:</strong><br><img src="${submission.photoPath}" class="task-photo" onclick="showImage('${submission.photoPath}')" /></div>` : 
                '<div><em>No photo uploaded</em></div>'
              }
            </div>
          `;
        }).join('');
        
        const createdDateTime = new Date(data.task.createdAt);
        const createdDateStr = createdDateTime.toLocaleDateString('en-GB');
        const createdTimeStr = createdDateTime.toLocaleTimeString('en-GB', { 
          hour12: true, hour: '2-digit', minute: '2-digit' 
        });
        
        document.getElementById('taskDetails').innerHTML = `
          <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
            <h4>${data.task.description}</h4>
            <div style="display: flex; justify-content: space-between; align-items: center; margin: 10px 0;">
              <span><strong>Status:</strong> ${data.task.status}</span>
              <span><strong>Total Submissions:</strong> ${data.task.totalSubmissions}</span>
            </div>
            <div style="font-size: 14px; color: #6c757d;">
              📅 Created: ${createdDateStr} at ${createdTimeStr}<br>
              👤 Assigned to: ${data.employee.name} (${data.employee.email})
              ${data.task.completedAt ? `<br>✅ Completed: ${new Date(data.task.completedAt).toLocaleDateString('en-GB')}` : ''}
            </div>
          </div>
          
          <h4>📋 Submission History</h4>
          <div style="max-height: 400px; overflow-y: auto;">
            ${data.submissions.length > 0 ? submissionsHtml : '<div style="text-align: center; padding: 20px; color: #6c757d;">No submissions yet</div>'}
          </div>
          
          ${data.task.status === 'Processing' ? 
            `<div style="margin-top: 20px; text-align: center;">
              <button onclick="completeTask('${data.task._id}')" style="background: #28a745; padding: 10px 20px;">✅ Mark as Completed</button>
            </div>` : ''
          }
        `;
        
        closeModal('employeeModal');
        document.getElementById('taskModal').style.display = 'block';
      } catch (error) {
        console.error('Error loading task history:', error);
        alert('Failed to load task history');
      }
    }

    // ✅ COMPLETE TASK (COMPLETE)
    async function completeTask(taskId) {
      if (!confirm('Are you sure you want to mark this task as completed?')) return;
      
      try {
        const response = await fetch(`/admin/complete-task/${taskId}`, {
          method: 'POST',
          headers: { 'Authorization': 'Bearer ' + token }
        });
        
        const result = await response.json();
        
        if (response.ok) {
          alert('✅ Task marked as completed successfully!');
          closeModal('taskModal');
          closeModal('employeeModal');
          loadReports(); // Refresh the reports
          loadStats(); // Refresh stats
        } else {
          alert('❌ Failed to complete task: ' + result.message);
        }
      } catch (error) {
        console.error('Error completing task:', error);
        alert('Failed to complete task');
      }
    }

    // ✅ SHOW IMAGE (COMPLETE)
    function showImage(imagePath) {
      document.getElementById('modalImage').src = imagePath;
      document.getElementById('imageModal').style.display = 'block';
    }

    // ✅ CLOSE MODAL (COMPLETE)
    function closeModal(modalId) {
      document.getElementById(modalId).style.display = 'none';
    }

    // ✅ DELETE GROUP (COMPLETE)
    async function deleteGroup(groupId) {
      if (!confirm('Are you sure you want to delete this group?')) return;
      
      try {
        const response = await fetch(`/admin/groups/${groupId}`, {
          method: 'DELETE',
          headers: { 'Authorization': 'Bearer ' + token }
        });
        
        const result = await response.json();
        
        if (response.ok) {
          alert('✅ Group deleted successfully!');
          loadGroups();
          loadGroupsForAssignment(); // Refresh assignment dropdown
        } else {
          alert('❌ Failed to delete group: ' + result.message);
        }
      } catch (error) {
        console.error('Error deleting group:', error);
        alert('Failed to delete group');
      }
    }

    // ✅ INDIVIDUAL TASK FORM (COMPLETE)
    document.getElementById('individualTaskForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const employeeId = document.getElementById('employeeSelect').value;
      const description = e.target.description.value;
      
      try {
        const response = await fetch('/admin/assign-task', {
          method: 'POST',
          headers: {
            'Authorization': 'Bearer ' + token,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ employeeId, description })
        });
        
        const result = await response.json();
        
        if (response.ok) {
          alert('✅ Task assigned successfully!');
          e.target.reset();
          loadStats();
        } else {
          alert('❌ Failed to assign task: ' + result.message);
        }
      } catch (error) {
        console.error('Error assigning task:', error);
        alert('Failed to assign task');
      }
    });

    // ✅ BULK TASK FORM (COMPLETE)
    document.getElementById('bulkTaskForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const description = e.target.description.value;
      
      if (!confirm(`Assign this task to ALL employees?`)) return;
      
      try {
        const response = await fetch('/admin/assign-task-to-all', {
          method: 'POST',
          headers: {
            'Authorization': 'Bearer ' + token,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ description })
        });
        
        const result = await response.json();
        
        if (response.ok) {
          alert(`✅ Task assigned to ${result.assignedCount} employees successfully!`);
          e.target.reset();
          loadStats();
        } else {
          alert('❌ Failed to assign task: ' + result.message);
        }
      } catch (error) {
        console.error('Error assigning bulk task:', error);
        alert('Failed to assign task');
      }
    });

    // ✅ GROUP TASK FORM (COMPLETE)
    document.getElementById('groupTaskForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const groupId = document.getElementById('assignGroupSelect').value;
      const description = e.target.description.value;
      
      if (!groupId) {
        alert('Please select a group');
        return;
      }
      
      try {
        const response = await fetch('/admin/assign-task-to-group', {
          method: 'POST',
          headers: {
            'Authorization': 'Bearer ' + token,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ groupId, description })
        });
        
        const result = await response.json();
        
        if (response.ok) {
          alert(`✅ Task assigned to group "${result.groupName}" (${result.assignedCount} members) successfully!`);
          e.target.reset();
          loadStats();
        } else {
          alert('❌ Failed to assign task to group: ' + result.message);
        }
      } catch (error) {
        console.error('Error assigning group task:', error);
        alert('Failed to assign task to group');
      }
    });

    // ✅ CREATE GROUP FORM (COMPLETE)
    document.getElementById('createGroupForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const groupName = e.target.groupName.value;
      const description = e.target.description.value;
      
      // Get selected employees
      const selectedEmployees = [];
      const checkboxes = document.querySelectorAll('#employeeSelector input[type="checkbox"]:checked');
      
      if (checkboxes.length === 0) {
        alert('Please select at least one employee');
        return;
      }
      
      checkboxes.forEach(cb => {
        const empId = cb.value;
        const emp = allEmployees.find(e => e._id === empId);
        if (emp) {
          selectedEmployees.push({
            id: emp._id,
            name: emp.name,
            email: emp.email
          });
        }
      });
      
      try {
        const response = await fetch('/admin/groups', {
          method: 'POST',
          headers: {
            'Authorization': 'Bearer ' + token,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            name: groupName,
            members: selectedEmployees,
            description: description
          })
        });
        
        const result = await response.json();
        
        if (response.ok) {
          alert(`✅ Group "${groupName}" created successfully with ${selectedEmployees.length} members!`);
          e.target.reset();
          // Uncheck all checkboxes
          checkboxes.forEach(cb => cb.checked = false);
          loadGroups();
          loadGroupsForAssignment(); // Refresh assignment dropdown
        } else {
          alert('❌ Failed to create group: ' + result.message);
        }
      } catch (error) {
        console.error('Error creating group:', error);
        alert('Failed to create group');
      }
    });

    // ✅ UTILITY FUNCTIONS (COMPLETE)
    function goToChat() {
      window.location.href = 'chat.html';
    }

    function logout() {
      if (confirm('Are you sure you want to logout?')) {
        localStorage.clear();
        window.location.href = 'index.html';
      }
    }

    // ✅ CLOSE MODALS ON OUTSIDE CLICK (COMPLETE)
    window.onclick = function(event) {
      const modals = ['employeeModal', 'taskModal', 'imageModal'];
      modals.forEach(modalId => {
        const modal = document.getElementById(modalId);
        if (event.target === modal) {
          modal.style.display = 'none';
        }
      });
    }

    // ✅ INITIALIZE PAGE (COMPLETE)
    document.addEventListener('DOMContentLoaded', function() {
      loadStats();
      loadEmployees();
      loadGroupsForAssignment();
    });
  </script>
</body>
</html>
